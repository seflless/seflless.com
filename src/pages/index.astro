---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

const allPosts = await getCollection("blog", ({ data }) => !data.draft);

const sortedPosts = allPosts.sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const featuredPosts = sortedPosts.filter((post) => post.data.pinned);
const recentPosts = sortedPosts.filter((post) => !post.data.pinned);

function formatDate(date: Date) {
  const month = date.toLocaleDateString("en-US", { month: "short" }).toUpperCase();
  const day = date.getDate();
  return { month, day };
}
---

<BaseLayout title="Francois Laberge">
  <div class="space-y-12">
    <!-- Hero -->
    <section>
      <h1 class="text-4xl md:text-5xl font-bold tracking-tight font-display">
        Hi, I'm<br />
        <span class="italic">Francois</span>
      </h1>
      <p class="mt-6 text-lg text-muted-foreground leading-relaxed">
        I build things on the web. This is my corner of the internet where I share
        projects, thoughts, and experiments.
      </p>
    </section>

    <!-- Featured -->
    {featuredPosts.length > 0 && (
      <section>
        <h2 class="text-xl font-semibold mb-4">Recommended</h2>
        <div class="space-y-3">
          {featuredPosts.map((post) => {
            const { month, day } = formatDate(post.data.date);
            return (
              <a href={`/blog/${post.slug}`} class="flex items-baseline gap-4 group py-1">
                <span class="text-sm text-muted-foreground shrink-0 w-16">
                  {month} {day}
                </span>
                <span class="group-hover:text-muted-foreground transition-colors">
                  {post.data.title}
                </span>
              </a>
            );
          })}
        </div>
      </section>
    )}

    <!-- Recent Posts -->
    {recentPosts.length > 0 && (
      <section>
        <h2 class="text-xl font-semibold mb-4">Recent Posts</h2>
        <div class="space-y-3">
          {recentPosts.map((post) => {
            const { month, day } = formatDate(post.data.date);
            return (
              <a href={`/blog/${post.slug}`} class="flex items-baseline gap-4 group py-1">
                <span class="text-sm text-muted-foreground shrink-0 w-16">
                  {month} {day}
                </span>
                <span class="group-hover:text-muted-foreground transition-colors">
                  {post.data.title}
                </span>
              </a>
            );
          })}
        </div>
      </section>
    )}
  </div>
</BaseLayout>
